{"version":3,"sources":["../../../../src/lib/actions/admin/action.ts","../../../../src/lib/actions/student/action.ts","../../../../src/lib/actions/professor/action.ts","../../../../src/lib/actions/manager/action.ts","../../../../.next-internal/server/app/dashboard/admin/schools/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server'\r\n\r\nimport { supabase } from '@/src/lib/actions/psql-connection'\r\nimport bcrypt from 'bcrypt';\r\n\r\nexport async function getData(table_name: string) {\r\n     const { data, error } = await supabase.from(table_name).select('*');\r\n\r\n     if (error) throw new Error(error.message);\r\n     return data ?? []\r\n}\r\n\r\nexport async function updateData(table_name: string, data: any, id: number, id_column: string) {\r\n     if (table_name === 'users' && data.password) {\r\n          data.password = await bcrypt.hash(data.password, 10);\r\n     }\r\n     const { error } = await supabase.from(table_name).update(data).eq(id_column, id);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n}\r\n\r\nexport async function insertData(table_name: string, data: any) {\r\n     if (table_name === 'users' && data.password) {\r\n          data.password = await bcrypt.hash(data.password, 10);\r\n     }\r\n     const { error } = await supabase.from(table_name).insert(data);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n\r\n}","'use server'\r\n\r\nimport { supabase } from '@/src/lib/actions/psql-connection'\r\n\r\nexport async function getData(table_name: string, columns: string, id_user?: number, id_work?: number) {\r\n\r\n     let query = supabase.from(table_name).select(columns);\r\n     if (id_user !== undefined) {\r\n          query = query.contains(\"id_students\", [id_user]);\r\n     }\r\n     if (id_work !== undefined) {\r\n          query = query.eq(\"id_work\", id_work);\r\n     }\r\n     const { data, error } = await query;\r\n     if (error) throw new Error(error.message);\r\n     return data ?? []\r\n}\r\n\r\nexport async function insertDataStudent(formData: FormData) {\r\n     const files = formData.getAll(\"files\") as File[];\r\n     const id_work = Number(formData.get(\"id_work\"));\r\n     const version = Number(formData.get(\"version\"));\r\n     const description = formData.get(\"description\");\r\n\r\n     if (files.length === 0 || isNaN(id_work)) throw new Error(\"Faltan datos\");\r\n\r\n     const documentUrls = await Promise.all(\r\n          files.map(async (file) => {\r\n               const ext = file.name.split(\".\").pop();\r\n               const fileName = `avance-${id_work}-${Date.now()}-${Math.random().toString(36).substring(7)}.${ext}`;\r\n\r\n               const { error: uploadError } = await supabase.storage\r\n                    .from(\"documents\")\r\n                    .upload(fileName, file);\r\n\r\n               if (uploadError) throw uploadError;\r\n\r\n               const { data: publicUrlData } = supabase.storage\r\n                    .from(\"documents\")\r\n                    .getPublicUrl(fileName);\r\n\r\n               if (!publicUrlData?.publicUrl) throw new Error(\"Error al obtener la URL pública\");\r\n\r\n               return publicUrlData.publicUrl;\r\n          })\r\n     );\r\n\r\n     const { error: insertError } = await supabase\r\n          .from(\"work_documents\")\r\n          .insert({\r\n               id_work: id_work,\r\n               version: version,\r\n               description: description,\r\n               document_paths: documentUrls,\r\n          });\r\n\r\n     if (insertError) {\r\n          throw insertError;\r\n     }\r\n\r\n     if (insertError) throw insertError;\r\n}","'use server'\r\n\r\nimport { supabase } from '@/src/lib/actions/psql-connection'\r\n\r\nexport async function getData(table_name: string, columns: string, id_user?: number) {\r\n\r\n  let query = supabase.from(table_name).select(columns);\r\n  if (id_user !== undefined) {\r\n    query = query.contains(\"id_professors\", [id_user]);\r\n  }\r\n  const { data, error } = await query;\r\n  if (error) throw new Error(error.message);\r\n  return data ?? []\r\n}\r\n\r\nexport async function getStudentsDetails(studentIds: number[]) {\r\n  const { data, error } = await supabase\r\n    .from(\"users\")\r\n    .select(\"id_user, name, email\")\r\n    .in(\"id_user\", studentIds);\r\n\r\n  if (error) throw error;\r\n  return data;\r\n}\r\n\r\nexport async function updateDataProfessor(formData: FormData) {\r\n  const id_work_documents = Number(formData.get(\"id_work_documents\"));\r\n  const professor_comments = formData.get(\"professor_comments\") as string;\r\n  const files = formData.getAll(\"files\") as File[];\r\n\r\n  if (files.length === 0 || isNaN(id_work_documents)) throw new Error(\"Faltan datos\");\r\n  const documentUrls = await Promise.all(\r\n    files.map(async (file) => {\r\n      const ext = file.name.split(\".\").pop();\r\n      const fileName = `avance-${id_work_documents}-${Date.now()}-${Math.random().toString(36).substring(7)}.${ext}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"documents\")\r\n        .upload(fileName, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: publicUrlData } = supabase.storage\r\n        .from(\"documents\")\r\n        .getPublicUrl(fileName);\r\n\r\n      if (!publicUrlData?.publicUrl) throw new Error(\"Error al obtener la URL pública\");\r\n\r\n      return publicUrlData.publicUrl;\r\n    })\r\n  );\r\n\r\n  const { error: insertError } = await supabase\r\n    .from(\"work_documents\").update({\r\n      professor_comments: professor_comments,\r\n      document_professor_paths: documentUrls\r\n    }).eq(\"id_work_documents\", id_work_documents);\r\n\r\n  if (insertError) {\r\n    throw insertError;\r\n  }\r\n\r\n  if (insertError) throw insertError;\r\n}","'use server'\r\n\r\nimport { supabase } from '@/src/lib/actions/psql-connection'\r\n\r\nexport async function getCustomData(table_name: string, colums: string = '*', id_school?: number, role?: number) {\r\n     let query = supabase.from(table_name).select(colums);\r\n     if (id_school !== undefined) {\r\n          query = query.eq('id_school', id_school);\r\n     }\r\n\r\n     if (role !== undefined) {\r\n          query = query.eq('id_role', role);\r\n     }\r\n     const { data, error } = await query;\r\n     if (error) throw new Error(error.message);\r\n     return data ?? []\r\n}\r\n\r\nexport async function updateUserStatus(data: any) {\r\n     const { error } = await supabase.from('users').update({ id_status: data.id_status }).eq('id_user', data.id_user);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n}\r\n\r\nexport async function createProject(setData: any) {\r\n     const payload = {\r\n          ...setData,\r\n          id_program: Number(setData.id_program),\r\n          id_school: Number(setData.id_school),\r\n          id_mode: Number(setData.id_mode)\r\n     };\r\n     const { data, error } = await supabase.from('works').insert(payload).select();\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n     await supabase.from('phase_work').insert({ id_phase: 1, id_work: data[0].id_work, initial_date: setData.initial_date, id_students: data[0].id_students, id_professors: data[0].id_professors });\r\n}\r\n\r\nexport async function updateProject(data: Map<any, any>, id: number) {\r\n     const { error } = await supabase.from('works').update(data).eq('id_work', id);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n}\r\n\r\nexport async function updatePhaseProjectDate(data: any) {\r\n     console.log(data)\r\n     const { error } = await supabase.from('phase_work').update({ end_date: data.end_date }).eq('id_work', data.id_work).eq('id_phase', data.id_phase);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n}\r\n\r\nexport async function updatePhaseProject(data: any) {\r\n     const payload = { ...data, id_work: Number(data.id_work), id_phase: Number(data.id_phase) }\r\n     const { error } = await supabase.from('phase_work').insert(payload);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n     await supabase.from('works').update({id_students:data.id_students,id_professors:data.id_professors}).eq('id_work', data.id_work);\r\n}","export {getData as '40dbeeb162e059ce773ea6d9a6027e012cc9ed5594'} from 'ACTIONS_MODULE0'\nexport {insertDataStudent as '40df1140757c877a0cf5908cbf3501a791abd968f4'} from 'ACTIONS_MODULE1'\nexport {updateDataProfessor as '4023375bd8a23baae2dbdd008432443971914172c5'} from 'ACTIONS_MODULE2'\nexport {insertData as '603f537fdc2a97a1500ac983e263e983cb53542d1f'} from 'ACTIONS_MODULE0'\nexport {updateData as '789356f77ab1b0865bf38f9fb0beb43681a836e7c7'} from 'ACTIONS_MODULE0'\nexport {createProject as '402620dffcd3c85786e3b09cbf5845ddde39a9ce98'} from 'ACTIONS_MODULE3'\nexport {updatePhaseProject as '40125bccffa017b42e903c0dcaad09bf605e682708'} from 'ACTIONS_MODULE3'\nexport {updatePhaseProjectDate as '404c6d4fcb17c8ca1923809c46ed86bb2511a6522c'} from 'ACTIONS_MODULE3'\nexport {updateProject as '60095e3d4e4173083ded4e8a12e6c7ddd48913e0d1'} from 'ACTIONS_MODULE3'\nexport {updateUserStatus as '40bc103f492b054c2a0e26064e9bcd8274593ac6c1'} from 'ACTIONS_MODULE3'\nexport {getCustomData as '7899d074825ab2fdb144caec3875c5e99aea2a7fa3'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":"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"}