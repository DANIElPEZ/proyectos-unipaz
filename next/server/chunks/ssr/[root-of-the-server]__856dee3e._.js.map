{"version":3,"sources":["../../../../src/lib/utils.ts","../../../../src/lib/actions/profile/action.ts"],"sourcesContent":["export function validateUser(user: number): boolean {\r\n  return /^[0-9]+$/.test(user.toString());\r\n}\r\n\r\nexport function validatePassword(password: string): boolean {\r\n  return /^[a-zA-Z0-9!@#$%^&*()_\\-+=\\[\\]{}|\\\\:;\"'<>,.?/]+$/.test(password);\r\n}\r\n\r\nexport function formatValue(value: any) {\r\n  if (value === null) return \"—\";\r\n  if (typeof value === \"boolean\") return value ? \"Sí\" : \"No\";\r\n  if (typeof value === \"object\") return JSON.stringify(value);\r\n  return String(value);\r\n}\r\n\r\nexport const getLastDocument = (docs: any[]) => {\r\n  if (!Array.isArray(docs) || docs.length === 0) return null;\r\n  return docs.reduce((latest, doc) =>\r\n    doc.version > latest.version ? doc : latest,\r\n  );\r\n};\r\n\r\nexport const formatDate = (date?: string) => {\r\n  if (!date) return \"-\";\r\n  return new Date(date).toLocaleDateString(\"es-CO\", {\r\n    year: \"numeric\",\r\n    month: \"short\",\r\n    day: \"numeric\",\r\n  });\r\n};","'use server'\r\n\r\nimport { supabase } from '@/src/lib/actions/psql-connection'\r\nimport { validatePassword } from '@/src/lib/utils'\r\nimport bcrypt from 'bcrypt';\r\n\r\nexport async function updatePassword(password: string, id: number) {\r\n     if (!validatePassword(password)) {\r\n          throw new Error('Contraseña invalida');\r\n     }\r\n     const hashedPassword = await bcrypt.hash(password, 10);\r\n     const { error } = await supabase.from('users').update({ password: hashedPassword }).eq('id_user', id);\r\n     if (error) {\r\n          throw new Error(error.message);\r\n     }\r\n}\r\n\r\nexport async function updateProfile(formData: FormData) {\r\n     const file = formData.get(\"file\") as File;\r\n     const userId = Number(formData.get(\"userId\"));\r\n\r\n     if (!file || !userId) {\r\n          throw new Error(\"Datos inválidos\");\r\n     }\r\n\r\n     const ext = file.name.split(\".\").pop();\r\n     const fileName = `avatar-${userId}-${Date.now()}.${ext}`;\r\n\r\n     const { error: uploadError } = await supabase.storage\r\n          .from(\"profiles\")\r\n          .upload(fileName, file, {\r\n               upsert: true,\r\n               contentType: file.type,\r\n          });\r\n\r\n     if (uploadError) throw uploadError;\r\n     const { data } = supabase.storage\r\n          .from(\"profiles\")\r\n          .getPublicUrl(fileName);\r\n\r\n     const imageUrl = data.publicUrl;\r\n     const { error } = await supabase\r\n          .from(\"users\")\r\n          .update({ photo: imageUrl })\r\n          .eq(\"id_user\", userId);\r\n\r\n     if (error) throw error;\r\n     return imageUrl;\r\n}"],"names":[],"mappings":"sGAAO,SAAS,EAAa,CAAY,EACvC,MAAO,WAAW,IAAI,CAAC,EAAK,QAAQ,GACtC,CAEO,SAAS,EAAiB,CAAgB,EAC/C,MAAO,mDAAmD,IAAI,CAAC,EACjE,+FCJA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAe,CAAgB,CAAE,CAAU,EAC5D,GAAI,CAAC,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,GACjB,MAAM,AAAI,EADkB,IACZ,uBAErB,IAAM,EAAiB,MAAM,EAAA,OAAM,CAAC,IAAI,CAAC,EAAU,IAC7C,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAAC,IAAI,CAAC,SAAS,MAAM,CAAC,CAAE,SAAU,CAAe,GAAG,EAAE,CAAC,UAAW,GAClG,GAAI,EACC,KADM,CACA,AAAI,MAAM,EAAM,OAAO,CAEvC,CAEO,eAAe,EAAc,CAAkB,EACjD,IAAM,EAAO,EAAS,GAAG,CAAC,QACpB,EAAS,OAAO,EAAS,GAAG,CAAC,WAEnC,GAAI,CAAC,GAAQ,CAAC,EACT,MADiB,AACX,AAAI,MAAM,mBAGrB,IAAM,EAAM,EAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,GAC9B,EAAW,CAAC,OAAO,EAAE,EAAO,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,EAAA,CAAK,CAElD,CAAE,MAAO,CAAW,CAAE,CAAG,MAAM,EAAA,QAAQ,CAAC,OAAO,CAC/C,IAAI,CAAC,YACL,MAAM,CAAC,EAAU,EAAM,CACnB,OAAQ,GACR,YAAa,EAAK,IAAI,AAC3B,GAEL,GAAI,EAAa,MAAM,EACvB,GAAM,MAAE,CAAI,CAAE,CAAG,EAAA,QAAQ,CAAC,OAAO,CAC3B,IAAI,CAAC,YACL,YAAY,CAAC,GAEb,EAAW,EAAK,SAAS,CACzB,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC1B,IAAI,CAAC,SACL,MAAM,CAAC,CAAE,MAAO,CAAS,GACzB,EAAE,CAAC,UAAW,GAEpB,GAAI,EAAO,MAAM,EACjB,OAAO,CACZ,0CA1CsB,EAWA,IAXA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAWA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}